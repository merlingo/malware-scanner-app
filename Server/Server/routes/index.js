'use strict';
var express = require('express');
var malhash = require('./hash_route');

var router = express.Router();
/* GET the list of malware hashes */
router.get('/', function (req, res) {
    //res.render('index', { title: 'Express' });
    //get all hashes from db
    malhash.find({}, function (err, hashes) {
        if (err) {
            console.log("ERR in malhash:");
            console.log(err);
            res.send(err);
            return;
        }
        //prepare hashlist - Another use case, just return a file which includes all hashes.
        res.json(prepareHashlist(hashes));
    //pack hashlist and include response
    });
   
});

function prepareHashlist(hashes) {

     //TO-DO: prepare hashlist
    return hashes;
}

/* POST add new hashes to db*/
router.post('/', function (req, res) {
    //get hash from request
    var mh = new malhash(req.body);

    //TO-DO: compare it with db whether it exist in db


    //create new malware-hash object and add to database
    mh.save(function (err) {
        if (err) {
            res.send(err);
            return;
        }
        // saved!
        res.status(200).send("success");
    });

    
});
module.exports = router;
